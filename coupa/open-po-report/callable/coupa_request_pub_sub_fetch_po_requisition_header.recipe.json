{
  "name": "Coupa Request Pub/Sub - Fetch PO Requisition Header",
  "description": "When there is a trigger event, do action",
  "version": 2,
  "private": true,
  "concurrency": 5,
  "code": {
    "number": 0,
    "provider": "workato_pub_sub",
    "name": "subscribe_to_topic",
    "as": "9114c6e7",
    "title": null,
    "description": "New <span class=\"provider\">message</span> in <span class=\"provider\">Coupa Requests</span> PubSub topic",
    "keyword": "trigger",
    "dynamicPickListSelection": {
      "topic_id": "Coupa Requests"
    },
    "toggleCfg": {
    },
    "input": {
      "since_offset": "-3600",
      "topic_id": {
        "zip_name": "coupa_requests.topic.json",
        "name": "Coupa Requests",
        "folder": ""
      }
    },
    "filter": {
      "conditions": [
        {
          "operand": "equals_to",
          "lhs": "#{_('data.workato_pub_sub.9114c6e7.message.type')}",
          "rhs": "fetch-po-req"
        }
      ],
      "operand": "and",
      "type": "compound"
    },
    "extended_output_schema": [
      {
        "type": "object",
        "name": "message",
        "label": "Message",
        "properties": [
          {
            "control_type": "text",
            "label": "Type",
            "name": "type",
            "type": "string",
            "optional": false,
            "hint": "fetch-open-pos, fetch-po-req, fetch-po-lines, send-open-po-report"
          },
          {
            "control_type": "integer",
            "label": "fetch-open-pos: Offset",
            "parse_output": "integer_conversion",
            "name": "fetch_open_pos_offset",
            "type": "integer",
            "optional": true,
            "hint": "offset for the next 50 POs to fetch"
          },
          {
            "control_type": "integer",
            "label": "fetch-open-pos: Thread Number",
            "parse_output": "float_conversion",
            "name": "fetch_open_pos_thread",
            "type": "integer",
            "optional": true,
            "hint": "identifier for the thread so we can track its status"
          },
          {
            "control_type": "integer",
            "label": "fetch-po-req: Purchase Order ID",
            "parse_output": "float_conversion",
            "name": "fetch_po_req_po_id",
            "type": "integer",
            "optional": true,
            "hint": "ID of the PO related to the Requisition"
          },
          {
            "control_type": "integer",
            "label": "fetch-po-req: Requisition ID",
            "parse_output": "integer_conversion",
            "name": "fetch_po_req_req_id",
            "type": "integer",
            "optional": true,
            "hint": "ID of the Requisition Header to fetch"
          },
          {
            "control_type": "integer",
            "label": "fetch-po-lines: Purchase Order ID",
            "parse_output": "integer_conversion",
            "name": "fetch_po_lines_po_id",
            "type": "integer",
            "optional": true,
            "hint": "ID of the Purchase Order related to the PO lines"
          },
          {
            "control_type": "text",
            "label": "send-open-po-report: Requisitioner Email",
            "name": "send_open_po_report_email",
            "type": "string",
            "optional": true,
            "hint": "email for which to send open PO report"
          }
        ]
      }
    ],
    "block": [
      {
        "number": 1,
        "keyword": "try",
        "dynamicPickListSelection": {
        },
        "toggleCfg": {
        },
        "input": {
        },
        "block": [
          {
            "number": 2,
            "provider": "coupa",
            "name": "__adhoc_http_action",
            "as": "c365a318",
            "title": "Custom action",
            "description": "Custom <span class=\"provider\">action</span> in <span class=\"provider\">Coupa</span> (Custom)",
            "keyword": "action",
            "dynamicPickListSelection": {
              "object": "Purchase order"
            },
            "toggleCfg": {
            },
            "input": {
              "mnemonic": "Custom action",
              "verb": "get",
              "path": "api/requisitions/#{_('data.workato_pub_sub.9114c6e7.message.fetch_po_req_req_id')}",
              "input": {
                "schema": "[{\"name\":\"filter\",\"type\":\"string\",\"optional\":true,\"label\":\"filter\",\"control_type\":\"text\"}]",
                "data": {
                  "filter": "open_po_report_requisition_filter"
                }
              },
              "request_headers": [
                {
                  "name": "ACCEPT",
                  "value": "application/json"
                }
              ],
              "output": "[{\"control_type\":\"number\",\"label\":\"ID\",\"parse_output\":\"float_conversion\",\"type\":\"number\",\"name\":\"id\"},{\"control_type\":\"text\",\"label\":\"Status\",\"type\":\"string\",\"name\":\"status\"},{\"control_type\":\"text\",\"label\":\"Total\",\"type\":\"string\",\"name\":\"total\"},{\"properties\":[{\"control_type\":\"number\",\"label\":\"ID\",\"parse_output\":\"float_conversion\",\"type\":\"number\",\"name\":\"id\"},{\"control_type\":\"text\",\"label\":\"Code\",\"type\":\"string\",\"name\":\"code\"},{\"control_type\":\"number\",\"label\":\"Decimals\",\"parse_output\":\"float_conversion\",\"type\":\"number\",\"name\":\"decimals\"}],\"label\":\"Currency\",\"type\":\"object\",\"name\":\"currency\"},{\"properties\":[{\"control_type\":\"number\",\"label\":\"ID\",\"parse_output\":\"float_conversion\",\"type\":\"number\",\"name\":\"id\"},{\"control_type\":\"text\",\"label\":\"Login\",\"type\":\"string\",\"name\":\"login\"},{\"control_type\":\"text\",\"label\":\"Employee-number\",\"type\":\"string\",\"name\":\"employee-number\"},{\"control_type\":\"text\",\"label\":\"Firstname\",\"type\":\"string\",\"name\":\"firstname\"},{\"control_type\":\"text\",\"label\":\"Lastname\",\"type\":\"string\",\"name\":\"lastname\"},{\"control_type\":\"text\",\"label\":\"Fullname\",\"type\":\"string\",\"name\":\"fullname\"},{\"control_type\":\"text\",\"label\":\"Email\",\"type\":\"string\",\"name\":\"email\"},{\"control_type\":\"text\",\"label\":\"Salesforce-id\",\"type\":\"string\",\"name\":\"salesforce-id\"},{\"control_type\":\"text\",\"label\":\"Rapid- 7 -dept\",\"type\":\"string\",\"name\":\"rapid-7-dept\"}],\"label\":\"Requested-by\",\"type\":\"object\",\"name\":\"requested-by\"}]",
              "response_type": "json"
            },
            "extended_output_schema": [
              {
                "type": "number",
                "name": "id",
                "control_type": "number",
                "label": "ID",
                "optional": true,
                "parse_output": "float_conversion"
              },
              {
                "type": "string",
                "name": "status",
                "control_type": "text",
                "label": "Status",
                "optional": true
              },
              {
                "type": "string",
                "name": "total",
                "control_type": "text",
                "label": "Total",
                "optional": true
              },
              {
                "type": "object",
                "name": "currency",
                "label": "Currency",
                "optional": true,
                "properties": [
                  {
                    "control_type": "number",
                    "label": "ID",
                    "parse_output": "float_conversion",
                    "optional": true,
                    "type": "number",
                    "name": "id"
                  },
                  {
                    "control_type": "text",
                    "label": "Code",
                    "optional": true,
                    "type": "string",
                    "name": "code"
                  },
                  {
                    "control_type": "number",
                    "label": "Decimals",
                    "parse_output": "float_conversion",
                    "optional": true,
                    "type": "number",
                    "name": "decimals"
                  }
                ]
              },
              {
                "type": "object",
                "name": "requested-by",
                "label": "Requested-by",
                "optional": true,
                "properties": [
                  {
                    "control_type": "number",
                    "label": "ID",
                    "parse_output": "float_conversion",
                    "optional": true,
                    "type": "number",
                    "name": "id"
                  },
                  {
                    "control_type": "text",
                    "label": "Login",
                    "optional": true,
                    "type": "string",
                    "name": "login"
                  },
                  {
                    "control_type": "text",
                    "label": "Employee-number",
                    "optional": true,
                    "type": "string",
                    "name": "employee-number"
                  },
                  {
                    "control_type": "text",
                    "label": "Firstname",
                    "optional": true,
                    "type": "string",
                    "name": "firstname"
                  },
                  {
                    "control_type": "text",
                    "label": "Lastname",
                    "optional": true,
                    "type": "string",
                    "name": "lastname"
                  },
                  {
                    "control_type": "text",
                    "label": "Fullname",
                    "optional": true,
                    "type": "string",
                    "name": "fullname"
                  },
                  {
                    "control_type": "text",
                    "label": "Email",
                    "optional": true,
                    "type": "string",
                    "name": "email"
                  },
                  {
                    "control_type": "text",
                    "label": "Salesforce-id",
                    "optional": true,
                    "type": "string",
                    "name": "salesforce-id"
                  },
                  {
                    "control_type": "text",
                    "label": "Rapid- 7 -dept",
                    "optional": true,
                    "type": "string",
                    "name": "rapid-7-dept"
                  }
                ]
              }
            ],
            "extended_input_schema": [
              {
                "type": "string",
                "name": "path",
                "control_type": "text",
                "label": "Path",
                "hint": "Base URI is <b>https://rapid7.coupahost.com/</b> - path will be appended to this URI. Use absolute URI to override this base URI.",
                "optional": false
              },
              {
                "type": "string",
                "name": "response_type",
                "control_type": "select",
                "label": "Reply type",
                "default": "json",
                "sticky": false,
                "pick_list": [
                  [
                    "JSON response",
                    "json"
                  ],
                  [
                    "Raw response",
                    "raw"
                  ]
                ],
                "optional": true,
                "extends_schema": true
              },
              {
                "type": "object",
                "name": "input",
                "control_type": "form-schema-builder",
                "label": "URL parameters",
                "sticky": false,
                "optional": true,
                "properties": [
                  {
                    "control_type": "text",
                    "label": "Schema",
                    "extends_schema": true,
                    "sticky": false,
                    "optional": true,
                    "type": "string",
                    "name": "schema",
                    "parent": "input"
                  },
                  {
                    "properties": [
                      {
                        "control_type": "text",
                        "label": "filter",
                        "optional": true,
                        "sticky": true,
                        "type": "string",
                        "name": "filter",
                        "parent": "input.data"
                      }
                    ],
                    "label": "Data",
                    "optional": true,
                    "type": "object",
                    "name": "data",
                    "parent": "input"
                  }
                ]
              },
              {
                "type": "array",
                "name": "request_headers",
                "control_type": "key_value",
                "label": "Request headers",
                "optional": true,
                "of": "object",
                "properties": [
                  {
                    "control_type": "text",
                    "label": "Name",
                    "optional": true,
                    "type": "string",
                    "name": "name",
                    "parent": "request_headers"
                  },
                  {
                    "control_type": "text",
                    "label": "Value",
                    "optional": true,
                    "type": "string",
                    "name": "value",
                    "parent": "request_headers"
                  }
                ]
              },
              {
                "type": "string",
                "name": "output",
                "control_type": "schema-designer",
                "label": "Output",
                "sticky": true,
                "optional": true,
                "extends_schema": true,
                "schema_neutral": true
              },
              {
                "type": "string",
                "name": "response_headers",
                "control_type": "schema-designer",
                "label": "Response headers",
                "sticky": false,
                "optional": true,
                "extends_schema": true,
                "schema_neutral": true
              }
            ],
            "visible_config_fields": [
              "mnemonic",
              "verb",
              "input",
              "input.schema",
              "output",
              "input.data.return_object",
              "path",
              "input.data.status",
              "input.data.offset",
              "input.data",
              "request_headers",
              "input.data.filter"
            ],
            "uuid": "96e1b4f5-d64c-459c-9a37-226c50a7eca3"
          },
          {
            "number": 3,
            "as": "509dd386",
            "keyword": "catch",
            "dynamicPickListSelection": {
            },
            "toggleCfg": {
            },
            "input": {
              "max_retry_count": "3",
              "retry_interval": "2"
            },
            "block": [
              {
                "number": 4,
                "keyword": "stop",
                "dynamicPickListSelection": {
                },
                "toggleCfg": {
                },
                "input": {
                  "stop_with_error": "true",
                  "stop_reason": "#{_('data.catch.509dd386.message')}"
                },
                "uuid": "9a44c604-b2a5-47a3-a55d-6c7ab2ccfd55"
              }
            ],
            "uuid": "70efc3c4-29d0-46b7-a5b0-53b321349961"
          }
        ],
        "uuid": "e0e6065a-1a66-4795-b822-e5c31dca03ad"
      },
      {
        "number": 5,
        "provider": "mysql",
        "name": "upsert_rows",
        "as": "853fde6d",
        "title": "Upsert row in coupa_open_po_report_po",
        "description": "Upsert <span class=\"provider\">row</span> in <span class=\"provider\">coupa_open_po_report_po</span> table in <span class=\"provider\">MySQL</span>",
        "keyword": "action",
        "dynamicPickListSelection": {
          "table": "coupa_open_po_report_po"
        },
        "toggleCfg": {
          "table": true
        },
        "input": {
          "table": "coupa_open_po_report_po",
          "columns": {
            "po_id": "=_('data.workato_pub_sub.9114c6e7.message.fetch_po_req_po_id').to_i",
            "req_email": "#{_('data.coupa.c365a318.requested-by.email')}",
            "total_req": "#{_('data.coupa.c365a318.total')}",
            "req_currency": "#{_('data.coupa.c365a318.currency.code')}"
          }
        },
        "extended_input_schema": [
          {
            "type": "object",
            "name": "columns",
            "label": "Columns",
            "properties": [
              {
                "control_type": "date_time",
                "label": "date_created",
                "render_input": "convert_date_time",
                "parse_output": "convert_date_time",
                "details": {
                  "data_type": "datetime",
                  "column_name": "date_created"
                },
                "optional": true,
                "hint": "datetime",
                "type": "date_time",
                "name": "date_created",
                "parent": "columns"
              },
              {
                "control_type": "number",
                "label": "po_id",
                "parse_output": "parse_integer_output",
                "details": {
                  "data_type": "int(11)",
                  "column_name": "po_id"
                },
                "render_input": "parse_integer_output",
                "event_title": true,
                "optional": true,
                "hint": "int(11), primary key",
                "type": "integer",
                "name": "po_id",
                "parent": "columns"
              },
              {
                "control_type": "number",
                "label": "po_number",
                "parse_output": "parse_integer_output",
                "details": {
                  "data_type": "int(11)",
                  "column_name": "po_number"
                },
                "render_input": "parse_integer_output",
                "optional": true,
                "hint": "int(11)",
                "type": "integer",
                "name": "po_number",
                "parent": "columns"
              },
              {
                "control_type": "text",
                "label": "req_currency",
                "details": {
                  "data_type": "varchar(45)",
                  "column_name": "req_currency"
                },
                "optional": true,
                "hint": "varchar(45)",
                "type": "string",
                "name": "req_currency",
                "parent": "columns"
              },
              {
                "control_type": "text",
                "label": "req_email",
                "details": {
                  "data_type": "varchar(100)",
                  "column_name": "req_email"
                },
                "optional": true,
                "hint": "varchar(100)",
                "type": "string",
                "name": "req_email",
                "parent": "columns"
              },
              {
                "control_type": "number",
                "label": "req_id",
                "parse_output": "parse_integer_output",
                "details": {
                  "data_type": "int(11)",
                  "column_name": "req_id"
                },
                "render_input": "parse_integer_output",
                "optional": true,
                "hint": "int(11)",
                "type": "integer",
                "name": "req_id",
                "parent": "columns"
              },
              {
                "control_type": "number",
                "label": "total_invoiced",
                "parse_output": "parse_numeric_output",
                "details": {
                  "data_type": "double",
                  "column_name": "total_invoiced"
                },
                "render_input": "parse_numeric_output",
                "optional": true,
                "hint": "double",
                "type": "number",
                "name": "total_invoiced",
                "parent": "columns"
              },
              {
                "control_type": "number",
                "label": "total_po",
                "parse_output": "parse_numeric_output",
                "details": {
                  "data_type": "double",
                  "column_name": "total_po"
                },
                "render_input": "parse_numeric_output",
                "optional": true,
                "hint": "double",
                "type": "number",
                "name": "total_po",
                "parent": "columns"
              },
              {
                "control_type": "number",
                "label": "total_remaining",
                "parse_output": "parse_numeric_output",
                "details": {
                  "data_type": "double",
                  "column_name": "total_remaining"
                },
                "render_input": "parse_numeric_output",
                "optional": true,
                "hint": "double",
                "type": "number",
                "name": "total_remaining",
                "parent": "columns"
              },
              {
                "control_type": "number",
                "label": "total_req",
                "parse_output": "parse_numeric_output",
                "details": {
                  "data_type": "double",
                  "column_name": "total_req"
                },
                "render_input": "parse_numeric_output",
                "optional": true,
                "hint": "double",
                "type": "number",
                "name": "total_req",
                "parent": "columns"
              },
              {
                "control_type": "text",
                "label": "vendor_name",
                "details": {
                  "data_type": "varchar(100)",
                  "column_name": "vendor_name"
                },
                "optional": true,
                "hint": "varchar(100)",
                "type": "string",
                "name": "vendor_name",
                "parent": "columns"
              }
            ]
          }
        ],
        "visible_config_fields": [
          "table",
          "columns.po_id",
          "columns.req_email",
          "columns.req_total",
          "columns",
          "columns.total_req",
          "columns.req_currency"
        ],
        "uuid": "4fc846a8-99a0-4fdd-a8f7-707f2a45bfa3"
      },
      {
        "number": 6,
        "provider": "mysql",
        "name": "upsert_rows",
        "as": "0eb1cf7f",
        "title": "Upsert row in coupa_open_po_report_req_email",
        "description": "Upsert <span class=\"provider\">row</span> in <span class=\"provider\">coupa_open_po_report_req_email</span> table in <span class=\"provider\">MySQL</span>",
        "keyword": "action",
        "dynamicPickListSelection": {
          "table": "coupa_open_po_report_req_email"
        },
        "toggleCfg": {
          "table": true
        },
        "input": {
          "table": "coupa_open_po_report_req_email",
          "columns": {
            "email": "#{_('data.coupa.c365a318.requested-by.email')}"
          }
        },
        "extended_input_schema": [
          {
            "type": "object",
            "name": "columns",
            "label": "Columns",
            "properties": [
              {
                "control_type": "text",
                "label": "email",
                "details": {
                  "data_type": "varchar(100)",
                  "column_name": "email"
                },
                "event_title": true,
                "optional": true,
                "hint": "varchar(100), primary key",
                "type": "string",
                "name": "email"
              },
              {
                "control_type": "number",
                "label": "po_count",
                "parse_output": "parse_integer_output",
                "details": {
                  "data_type": "int(11)",
                  "column_name": "po_count"
                },
                "render_input": "parse_integer_output",
                "optional": true,
                "hint": "int(11)",
                "type": "integer",
                "name": "po_count"
              }
            ]
          }
        ],
        "visible_config_fields": [
          "table",
          "columns.email"
        ],
        "uuid": "feb72794-0154-417e-84b2-46be5d3c529c"
      }
    ],
    "job_report_schema": [
      {
        "name": "custom_column_1",
        "label": "PO ID"
      },
      {
        "name": "custom_column_2",
        "label": "Req ID"
      }
    ],
    "job_report_config": {
      "custom_column_1": "=_('data.workato_pub_sub.9114c6e7.message.fetch_po_req_po_id').to_i",
      "custom_column_2": "#{_('data.workato_pub_sub.9114c6e7.message.fetch_po_req_req_id')}"
    },
    "uuid": "4b7319ad-737e-419a-973f-042bbd54d059"
  },
  "config": [
    {
      "keyword": "application",
      "provider": "workato_pub_sub",
      "account_id": null
    },
    {
      "keyword": "application",
      "provider": "coupa",
      "account_id": {
        "zip_name": "resources/coupa.connection.json",
        "name": "Coupa",
        "folder": "resources"
      }
    },
    {
      "keyword": "application",
      "provider": "mysql",
      "account_id": {
        "zip_name": "resources/mysql.connection.json",
        "name": "MySQL",
        "folder": "resources"
      }
    }
  ]
}