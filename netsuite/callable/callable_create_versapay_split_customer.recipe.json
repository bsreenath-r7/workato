{
  "name": "Callable - Create VersaPay Split Customer",
  "description": "When there is a trigger event, do action",
  "version": 1,
  "private": true,
  "concurrency": 5,
  "code": {
    "number": 0,
    "provider": "workato_service",
    "name": "receive_request",
    "as": "f329a0d7",
    "title": null,
    "description": "New <span class=\"provider\">call</span> for <span class=\"provider\">Create VersaPay Split Customer</span>",
    "keyword": "trigger",
    "dynamicPickListSelection": {
    },
    "toggleCfg": {
    },
    "input": {
      "service_name": "Create VersaPay Split Customer",
      "request_schema_json": "[{\"control_type\":\"text\",\"label\":\"NetSuite Customer Internal ID\",\"name\":\"ns_customer_internal_id\",\"type\":\"string\",\"optional\":false},{\"control_type\":\"text\",\"label\":\"Ns customer name\",\"name\":\"ns_customer_name\",\"type\":\"string\",\"optional\":false,\"hint\":\"Name of the parent customer in NetSuite (will be used to create the split customer name)\"},{\"control_type\":\"text\",\"label\":\"Ns invoice billing country code\",\"name\":\"ns_invoice_billing_country_code\",\"type\":\"string\",\"optional\":false,\"hint\":\"Billing Country Code of the invoice to use when splitting the customer.  If the invoice billing country code is CA, the VersaPay customer identifier will be cust-[id]-splitca\"},{\"control_type\":\"text\",\"label\":\"Ns invoice billing country\",\"name\":\"ns_invoice_billing_country\",\"type\":\"string\",\"optional\":false,\"hint\":\"Billing Country of the invoice to use when splitting the customer.  If the invoice billing country is Canada, the VersaPay customer name will be [company x] (Canada)\"}]",
      "reply_schema_json": "[{\"control_type\":\"text\",\"label\":\"VersaPay Customer Identifier\",\"name\":\"versapay_customer_identifier\",\"type\":\"string\",\"optional\":false,\"hint\":\"Contains the ID of the VersaPay Customer that was upserted ('0' if no upsert was completed)\"}]"
    },
    "extended_output_schema": [
      {
        "type": "object",
        "name": "request",
        "label": "Recipe input",
        "properties": [
          {
            "control_type": "text",
            "label": "NetSuite Customer Internal ID",
            "name": "ns_customer_internal_id",
            "type": "string",
            "optional": false
          },
          {
            "control_type": "text",
            "label": "Ns customer name",
            "name": "ns_customer_name",
            "type": "string",
            "optional": false,
            "hint": "Name of the parent customer in NetSuite (will be used to create the split customer name)"
          },
          {
            "control_type": "text",
            "label": "Ns invoice billing country code",
            "name": "ns_invoice_billing_country_code",
            "type": "string",
            "optional": false,
            "hint": "Billing Country Code of the invoice to use when splitting the customer.  If the invoice billing country code is CA, the VersaPay customer identifier will be cust-[id]-splitca"
          },
          {
            "control_type": "text",
            "label": "Ns invoice billing country",
            "name": "ns_invoice_billing_country",
            "type": "string",
            "optional": false,
            "hint": "Billing Country of the invoice to use when splitting the customer.  If the invoice billing country is Canada, the VersaPay customer name will be [company x] (Canada)"
          }
        ]
      }
    ],
    "block": [
      {
        "number": 1,
        "provider": "workato_service",
        "name": "call_service",
        "as": "f93ad92b",
        "title": null,
        "description": "Call recipe <span class=\"provider\">Convert NetSuite Internal ID to VersaPay Identifier</span> ",
        "keyword": "action",
        "dynamicPickListSelection": {
          "flow_id": "Convert NS Internal ID to VersaPay Identifier"
        },
        "toggleCfg": {
        },
        "input": {
          "flow_id": {
            "zip_name": "netsuite/callable/callable_convert_netsuite_internal_id_to_versapay_identifier.recipe.json",
            "name": "Callable - Convert NetSuite Internal ID to VersaPay Identifier",
            "folder": "netsuite/callable"
          },
          "request": {
            "type": "cust-",
            "ns_internal_id": "#{_('data.workato_service.f329a0d7.request.ns_customer_internal_id')}"
          }
        },
        "extended_output_schema": [
          {
            "type": "object",
            "name": "reply",
            "label": "Reply",
            "properties": [
              {
                "control_type": "text",
                "label": "VersaPay Identifier",
                "name": "versapay_identifier",
                "type": "string",
                "optional": false
              }
            ]
          }
        ],
        "extended_input_schema": [
          {
            "type": "object",
            "name": "request",
            "label": "Recipe input",
            "properties": [
              {
                "control_type": "text",
                "label": "NetSuite Internal ID",
                "name": "ns_internal_id",
                "type": "string",
                "optional": false,
                "parent": "request"
              },
              {
                "control_type": "select",
                "label": "Type",
                "type": "string",
                "name": "type",
                "pick_list": [
                  [
                    "Contact",
                    "con-"
                  ],
                  [
                    "Customer",
                    "cust-"
                  ],
                  [
                    "Invoice",
                    "invo-"
                  ],
                  [
                    "Partner",
                    "par-"
                  ],
                  [
                    "Payment",
                    "pmt-"
                  ]
                ],
                "parent": "request"
              }
            ]
          }
        ],
        "uuid": "38a7be71-4f5b-44c2-bca4-3237f7c5c921"
      },
      {
        "number": 2,
        "provider": "workato_variable",
        "name": "declare_variable",
        "as": "dcd1cde8",
        "title": "Create variable customer_identifier",
        "description": "Create variable <span class=\"provider\">customer_identifier</span>",
        "keyword": "action",
        "dynamicPickListSelection": {
        },
        "toggleCfg": {
        },
        "input": {
          "type": "string",
          "name": "customer_identifier",
          "value": "=_('data.workato_service.f93ad92b.reply.versapay_identifier')+\"-split\"+_('data.workato_service.f329a0d7.request.ns_invoice_billing_country_code').downcase"
        },
        "extended_output_schema": [
          {
            "type": "string",
            "name": "value",
            "control_type": "text",
            "label": "customer_identifier"
          }
        ],
        "extended_input_schema": [
          {
            "type": "string",
            "name": "value",
            "control_type": "text",
            "label": "Default value",
            "hint": "Default value for the variable",
            "sticky": true,
            "optional": true,
            "strip_interpolation": true
          }
        ],
        "uuid": "43df0745-4084-4003-830f-a366a1276a5e"
      },
      {
        "number": 3,
        "provider": "workato_service",
        "name": "call_service",
        "as": "2a519e1f",
        "title": null,
        "description": "Call recipe <span class=\"provider\">Does VersaPay Customer Exist?</span> ",
        "keyword": "action",
        "dynamicPickListSelection": {
          "flow_id": "Does VersaPay Customer Exist?"
        },
        "toggleCfg": {
        },
        "input": {
          "flow_id": {
            "zip_name": "versapay/callable/callable_does_versapay_customer_exist.recipe.json",
            "name": "Callable - Does VersaPay Customer Exist?",
            "folder": "versapay/callable"
          },
          "request": {
            "versapay_customer_identifier": "#{_('data.workato_variable.dcd1cde8.value')}"
          }
        },
        "extended_output_schema": [
          {
            "type": "object",
            "name": "reply",
            "label": "Reply",
            "properties": [
              {
                "control_type": "checkbox",
                "label": "Customer Exists",
                "render_input": {
                },
                "parse_output": {
                },
                "toggle_hint": "Select from option list",
                "toggle_field": {
                  "label": "Customer Exists",
                  "control_type": "text",
                  "toggle_hint": "Use custom value",
                  "name": "customer_exists",
                  "type": "boolean",
                  "optional": false
                },
                "name": "customer_exists",
                "type": "boolean",
                "optional": false
              }
            ]
          }
        ],
        "extended_input_schema": [
          {
            "type": "object",
            "name": "request",
            "label": "Recipe input",
            "properties": [
              {
                "control_type": "text",
                "label": "VersaPay Customer Identifier",
                "name": "versapay_customer_identifier",
                "type": "string",
                "optional": false,
                "parent": "request"
              }
            ]
          }
        ],
        "uuid": "4a1eacfd-8d0e-42d5-9778-d7d566ae74d9"
      },
      {
        "number": 4,
        "keyword": "if",
        "dynamicPickListSelection": {
        },
        "toggleCfg": {
        },
        "input": {
          "type": "compound",
          "operand": "and",
          "conditions": [
            {
              "operand": "is_true",
              "lhs": "#{_('data.workato_service.2a519e1f.reply.customer_exists')}",
              "rhs": null
            }
          ]
        },
        "block": [
          {
            "number": 5,
            "provider": "workato_service",
            "name": "send_reply",
            "as": "3d4eca83",
            "title": null,
            "description": "Return <span class=\"provider\">response</span> from <span class=\"provider\">Upsert NetSuite Customer to VersaPay Customer</span>",
            "keyword": "action",
            "dynamicPickListSelection": {
            },
            "toggleCfg": {
            },
            "input": {
              "reply_type": "success",
              "reply": {
                "versapay_customer_identifier": "#{_('data.workato_variable.dcd1cde8.value')}"
              }
            },
            "extended_input_schema": [
              {
                "type": "object",
                "name": "reply",
                "label": "Reply",
                "properties": [
                  {
                    "control_type": "text",
                    "label": "VersaPay Customer Identifier",
                    "name": "versapay_customer_identifier",
                    "type": "string",
                    "optional": false,
                    "hint": "Contains the ID of the VersaPay Customer that was upserted ('0' if no upsert was completed)",
                    "parent": "reply"
                  }
                ]
              }
            ],
            "comment": "Customer exists, no further action needed!",
            "uuid": "0d756a1a-0906-4425-964e-35dace3e97fc"
          },
          {
            "number": 6,
            "keyword": "stop",
            "dynamicPickListSelection": {
            },
            "toggleCfg": {
            },
            "input": {
              "stop_with_error": "false"
            },
            "uuid": "c8c5ec97-f111-4d62-a384-2d906cc69adb"
          }
        ],
        "comment": "Check to see if the customer needs to be created.",
        "uuid": "f30927f0-ad95-4db2-8f33-76e0b7a19d73",
        "collapsed_conditions": [
          "db8eedf9-7ec8-4887-a3e0-3d1a9fbe3e63",
          "f7b8a95a-0a02-45c7-9706-9247725769b9"
        ]
      },
      {
        "number": 7,
        "keyword": "try",
        "dynamicPickListSelection": {
        },
        "toggleCfg": {
        },
        "input": {
        },
        "block": [
          {
            "number": 8,
            "keyword": "try",
            "dynamicPickListSelection": {
            },
            "toggleCfg": {
            },
            "input": {
            },
            "block": [
              {
                "number": 9,
                "provider": "versa_pay_arc_connector_36450_1556732749",
                "name": "upsert_customer",
                "as": "812cebce",
                "title": null,
                "description": null,
                "keyword": "action",
                "dynamicPickListSelection": {
                },
                "toggleCfg": {
                },
                "input": {
                  "identifier": "#{_('data.workato_variable.dcd1cde8.value')}",
                  "name": "#{_('data.workato_service.f329a0d7.request.ns_customer_name')} (#{_('data.workato_service.f329a0d7.request.ns_invoice_billing_country')})",
                  "parent_identifier": "#{_('data.workato_service.f93ad92b.reply.versapay_identifier')}"
                },
                "visible_config_fields": [
                  "identifier",
                  "name",
                  "parent_identifier"
                ],
                "uuid": "90ea651a-b350-43ff-b771-cf0ae2a243f9"
              },
              {
                "number": 10,
                "as": "a33b4eed",
                "keyword": "catch",
                "dynamicPickListSelection": {
                },
                "toggleCfg": {
                },
                "input": {
                  "max_retry_count": "3",
                  "retry_interval": "5"
                },
                "filter": {
                  "conditions": [
                    {
                      "operand": "starts_with",
                      "lhs": "#{_('data.catch.a33b4eed.message')}",
                      "rhs": "504 Gateway Timeout"
                    }
                  ],
                  "operand": "and",
                  "type": "compound"
                },
                "block": [
                  {
                    "number": 11,
                    "keyword": "stop",
                    "dynamicPickListSelection": {
                    },
                    "toggleCfg": {
                    },
                    "input": {
                      "stop_with_error": "true",
                      "stop_reason": "Cannot upsert customer #{_('data.workato_service.f329a0d7.request.ns_customer_internal_id')}: #{_('data.catch.a33b4eed.message')}"
                    },
                    "uuid": "acd7ae1c-be0f-4467-9332-1a3304a74bbb"
                  }
                ],
                "uuid": "f6a05caa-9cae-423f-9962-7a2337a26c53"
              }
            ],
            "uuid": "c9ba5830-496f-485a-9f31-2d1019d19d00"
          },
          {
            "number": 12,
            "as": "743c0196",
            "keyword": "catch",
            "dynamicPickListSelection": {
            },
            "toggleCfg": {
            },
            "input": {
              "max_retry_count": "0",
              "retry_interval": "2"
            },
            "block": [
              {
                "number": 13,
                "provider": "workato_service",
                "name": "send_reply",
                "as": "1899294a",
                "title": null,
                "description": "Return <span class=\"provider\">response</span> from <span class=\"provider\">Upsert NetSuite Customer to VersaPay Customer</span>",
                "keyword": "action",
                "dynamicPickListSelection": {
                },
                "toggleCfg": {
                },
                "input": {
                  "reply_type": "error",
                  "message": "#{_('data.catch.743c0196.message')}"
                },
                "extended_input_schema": [
                  {
                    "type": "string",
                    "name": "message",
                    "control_type": "text",
                    "label": "Message",
                    "hint": "Error message"
                  },
                  {
                    "type": "string",
                    "name": "code",
                    "control_type": "text",
                    "label": "Error code",
                    "hint": "Use this field to set custom HTTP error code for service replies. E.g: 404/422 etc. This field is applicable to REST service recipes.",
                    "optional": true
                  },
                  {
                    "type": "boolean",
                    "name": "custom_error_response",
                    "control_type": "checkbox",
                    "label": "Custom error response?",
                    "hint": "By default, Workato sends 'reply_type' and 'message' fields in response. When set to 'Yes', the content of the 'Message' field is sent as response body. This field is applicable to REST service recipes.",
                    "optional": true,
                    "toggle_hint": "Select from option list",
                    "toggle_field": {
                      "label": "Custom error response?",
                      "control_type": "text",
                      "toggle_hint": "Use custom value",
                      "optional": true,
                      "hint": "By default, Workato sends 'reply_type' and 'message' fields in response. When set to 'Yes', the content of the 'Message' field is sent as response body. This field is applicable to REST service recipes.",
                      "type": "boolean",
                      "name": "custom_error_response"
                    },
                    "render_input": {
                    },
                    "parse_output": {
                    }
                  }
                ],
                "comment": "Pass error back to calling recipe",
                "uuid": "e2322a10-1e27-4afb-87fe-83171252a92c"
              },
              {
                "number": 14,
                "keyword": "stop",
                "dynamicPickListSelection": {
                },
                "toggleCfg": {
                },
                "input": {
                  "stop_with_error": "true",
                  "stop_reason": "#{_('data.catch.743c0196.message')}"
                },
                "uuid": "9b3e8649-e1c5-4c01-b6ca-72c8015fcb8e"
              }
            ],
            "uuid": "8376f9e7-0dd8-4825-a416-c58c889d0df8"
          }
        ],
        "uuid": "9c71dfe9-f406-4d92-a115-fa972ab993b7"
      },
      {
        "number": 15,
        "provider": "workato_service",
        "name": "send_reply",
        "as": "79160664",
        "title": null,
        "description": "Return <span class=\"provider\">response</span> from <span class=\"provider\">Upsert NetSuite Customer to VersaPay Customer</span>",
        "keyword": "action",
        "dynamicPickListSelection": {
        },
        "toggleCfg": {
        },
        "input": {
          "reply_type": "success",
          "reply": {
            "versapay_customer_identifier": "#{_('data.workato_variable.dcd1cde8.value')}"
          }
        },
        "extended_input_schema": [
          {
            "type": "object",
            "name": "reply",
            "label": "Reply",
            "properties": [
              {
                "control_type": "text",
                "label": "VersaPay Customer Identifier",
                "name": "versapay_customer_identifier",
                "type": "string",
                "optional": false,
                "hint": "Contains the ID of the VersaPay Customer that was upserted ('0' if no upsert was completed)",
                "parent": "reply"
              }
            ]
          }
        ],
        "comment": "Return the Identifier of the VersaPay Customer that was updated",
        "uuid": "25079dd2-cd01-469a-82f0-4668e0afad9d"
      }
    ],
    "job_report_schema": [
      {
        "name": "custom_column_1",
        "label": "Internal ID"
      },
      {
        "name": "custom_column_2",
        "label": "Customer Name"
      },
      {
        "name": "custom_column_4",
        "label": "Country"
      }
    ],
    "job_report_config": {
      "custom_column_1": "#{_('data.workato_service.f329a0d7.request.ns_customer_internal_id')}",
      "custom_column_2": "=_('data.workato_service.f329a0d7.request.ns_customer_name')",
      "custom_column_4": "=_('data.workato_service.f329a0d7.request.ns_invoice_billing_country_code')"
    },
    "uuid": "7587a7ab-2bae-43c6-a884-85ca14392190"
  },
  "config": [
    {
      "keyword": "application",
      "provider": "workato_service",
      "account_id": null
    },
    {
      "keyword": "application",
      "provider": "versa_pay_arc_connector_36450_1556732749",
      "account_id": {
        "zip_name": "resources/versapay_arc.connection.json",
        "name": "VersaPay ARC",
        "folder": "resources",
        "custom": true
      }
    },
    {
      "keyword": "application",
      "provider": "workato_variable",
      "account_id": null
    }
  ]
}