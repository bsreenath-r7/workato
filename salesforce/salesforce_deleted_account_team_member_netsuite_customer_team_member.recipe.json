{
  "name": "Salesforce Deleted Account Team Member - Netsuite Customer Team Member",
  "description": "**Description:** When the user record for the CSM Account Team role in Salesforce is deleted by a user or via Dataloader, Workato will also delete the corresponding record for the account in NetSuite.\n\n**Trigger:**  New event published in AccountTeamMemberDeleteEvent platform event in Salesforce\n\n**Actions:** \n\n1. Search for Account team member with the same role as a deleted team member\n2. If found use the NetSuite employee id of that user to replace a relevant team member in Netsuite, else remove the existing user in Salesforce by calling `Callable - Update NetSuite Customer Team Member`\n\n\n\n\n",
  "version": 2,
  "private": true,
  "concurrency": 5,
  "code": {
    "number": 0,
    "provider": "salesforce",
    "name": "new_platform_event",
    "as": "3bcc59df",
    "title": "New Account Team Member Delete Event",
    "description": "New <span class=\"provider\">Account Team Member Delete Event</span> event in <span class=\"provider\">Salesforce</span>",
    "keyword": "trigger",
    "dynamicPickListSelection": {
      "event_name": "Account Team Member Delete Event"
    },
    "toggleCfg": {
    },
    "input": {
      "event_name": "AccountTeamMemberDeleteEvent__e"
    },
    "extended_output_schema": [
      {
        "type": "string",
        "name": "CreatedById",
        "control_type": "text",
        "label": "Created By ID",
        "optional": true,
        "custom": false,
        "foreign_key": "User",
        "fetch_with": "get_custom_object(id, sobject_name: User)",
        "join_point_label": "Created  by",
        "sfdc_createable": false,
        "sfdc_updateable": false
      },
      {
        "type": "object",
        "name": "get_custom_object+CreatedById",
        "label": "Created  by",
        "properties": [

        ],
        "fetch_with": "get_custom_object(CreatedById>id, sobject_name: User)",
        "join_point": true
      },
      {
        "type": "date_time",
        "name": "CreatedDate",
        "control_type": "date_time",
        "label": "Created Date",
        "optional": true,
        "custom": false,
        "render_input": "render_iso8601_timestamp",
        "parse_output": "parse_iso8601_timestamp",
        "sfdc_createable": false,
        "sfdc_updateable": false
      },
      {
        "type": "string",
        "name": "ReplayId",
        "control_type": "text",
        "label": "Replay ID",
        "optional": true,
        "custom": false,
        "sfdc_createable": false,
        "sfdc_updateable": false
      },
      {
        "type": "string",
        "name": "AccountId__c",
        "control_type": "text",
        "label": "Account Id",
        "optional": true,
        "custom": true,
        "sfdc_createable": true,
        "sfdc_updateable": false
      },
      {
        "type": "string",
        "name": "AccountTeamMemberId__c",
        "control_type": "text",
        "label": "Account Team Member Id",
        "optional": true,
        "custom": true,
        "sfdc_createable": true,
        "sfdc_updateable": false
      },
      {
        "type": "string",
        "name": "NetsuiteCustomerId__c",
        "control_type": "text",
        "label": "Netsuite Customer Id",
        "optional": true,
        "custom": true,
        "sfdc_createable": true,
        "sfdc_updateable": false
      },
      {
        "type": "string",
        "name": "NetsuiteEmployeeId__c",
        "control_type": "text",
        "label": "Netsuite Employee Id",
        "optional": true,
        "custom": true,
        "sfdc_createable": true,
        "sfdc_updateable": false
      },
      {
        "type": "string",
        "name": "TeamRole__c",
        "control_type": "text",
        "label": "Team Role",
        "optional": true,
        "custom": true,
        "sfdc_createable": true,
        "sfdc_updateable": false
      },
      {
        "type": "string",
        "name": "UserId__c",
        "control_type": "text",
        "label": "User Id",
        "optional": true,
        "custom": true,
        "sfdc_createable": true,
        "sfdc_updateable": false
      }
    ],
    "block": [
      {
        "number": 1,
        "provider": "salesforce",
        "name": "search_sobjects",
        "as": "572a57ef",
        "title": "Search Account team members",
        "description": "Search for <span class=\"provider\">Account team members</span> in <span class=\"provider\">Salesforce</span>",
        "keyword": "action",
        "dynamicPickListSelection": {
          "sobject_name": "Account team member",
          "field_list": [
            {
              "label": "Account ID",
              "value": "AccountId"
            },
            {
              "label": "Team Role",
              "value": "TeamMemberRole"
            },
            {
              "label": "User.NetSuite Employee ID",
              "value": "User$User ID.NetsuiteEmployeeId__c"
            },
            {
              "label": "User.Full Name",
              "value": "User$User ID.Name"
            },
            {
              "label": "User.Employee ID",
              "value": "User$User ID.EmployeeID__c"
            },
            {
              "label": "User.Employee Number",
              "value": "User$User ID.EmployeeNumber"
            }
          ],
          "table_list": [
            {
              "label": "User",
              "value": "User"
            }
          ]
        },
        "toggleCfg": {
          "TeamMemberRole": false
        },
        "input": {
          "sobject_name": "AccountTeamMember",
          "limit": "1",
          "field_list": "AccountId\nTeamMemberRole\nUser$User ID.NetsuiteEmployeeId__c\nUser$User ID.Name\nUser$User ID.EmployeeID__c\nUser$User ID.EmployeeNumber",
          "AccountId": "#{_('data.salesforce.3bcc59df.AccountId__c')}",
          "TeamMemberRole": "#{_('data.salesforce.3bcc59df.TeamRole__c')}",
          "table_list": "User"
        },
        "extended_output_schema": [
          {
            "type": "array",
            "name": "AccountTeamMember",
            "label": "Account Team",
            "of": "object",
            "properties": [
              {
                "control_type": "text",
                "label": "Account ID",
                "custom": false,
                "sfdc_createable": true,
                "sfdc_updateable": false,
                "type": "string",
                "name": "AccountId"
              },
              {
                "control_type": "select",
                "label": "Team Role",
                "pick_list": "sobject_field_values_list",
                "pick_list_params": {
                  "sobject_name": "\"AccountTeamMember\""
                },
                "toggle_hint": "Select from list",
                "toggle_field": {
                  "control_type": "text",
                  "label": "Team Role",
                  "toggle_hint": "Enter custom value",
                  "optional": true,
                  "custom": false,
                  "sfdc_createable": true,
                  "sfdc_updateable": true,
                  "type": "string",
                  "name": "TeamMemberRole"
                },
                "optional": true,
                "custom": false,
                "sfdc_createable": true,
                "sfdc_updateable": true,
                "type": "string",
                "name": "TeamMemberRole"
              },
              {
                "properties": [
                  {
                    "control_type": "text",
                    "label": "Employee Number",
                    "optional": true,
                    "custom": false,
                    "sfdc_createable": true,
                    "sfdc_updateable": true,
                    "type": "string",
                    "name": "EmployeeNumber"
                  },
                  {
                    "control_type": "text",
                    "label": "Full Name",
                    "event_title": true,
                    "custom": false,
                    "sfdc_createable": false,
                    "sfdc_updateable": false,
                    "type": "string",
                    "name": "Name"
                  },
                  {
                    "control_type": "text",
                    "label": "Employee ID",
                    "optional": true,
                    "custom": true,
                    "sfdc_createable": true,
                    "sfdc_updateable": true,
                    "type": "string",
                    "name": "EmployeeID__c"
                  },
                  {
                    "control_type": "text",
                    "label": "NetSuite Employee ID",
                    "optional": true,
                    "custom": true,
                    "sfdc_createable": true,
                    "sfdc_updateable": true,
                    "type": "string",
                    "name": "NetsuiteEmployeeId__c"
                  }
                ],
                "label": "User",
                "type": "object",
                "name": "User"
              }
            ]
          },
          {
            "type": "integer",
            "name": "list_size",
            "control_type": "number",
            "label": "List size",
            "parse_output": "integer_conversion"
          }
        ],
        "extended_input_schema": [
          {
            "type": "string",
            "name": "AccountAccessLevel",
            "control_type": "select",
            "label": "Account Access",
            "pick_list": "sobject_field_values_list",
            "pick_list_params": {
              "sobject_name": "\"AccountTeamMember\""
            },
            "optional": true,
            "custom": false,
            "toggle_hint": "Select from list",
            "toggle_field": {
              "control_type": "text",
              "label": "Account Access",
              "toggle_hint": "Enter custom value",
              "optional": true,
              "custom": false,
              "sfdc_createable": true,
              "sfdc_updateable": true,
              "type": "string",
              "name": "AccountAccessLevel"
            },
            "sfdc_createable": true,
            "sfdc_updateable": true
          },
          {
            "type": "string",
            "name": "AccountId",
            "control_type": "text",
            "label": "Account ID",
            "sticky": true,
            "optional": true,
            "custom": false,
            "sfdc_createable": true,
            "sfdc_updateable": false
          },
          {
            "type": "string",
            "name": "Id",
            "control_type": "text",
            "label": "Account Team Member ID",
            "optional": true,
            "custom": false,
            "sfdc_createable": false,
            "sfdc_updateable": false
          },
          {
            "type": "string",
            "name": "CaseAccessLevel",
            "control_type": "select",
            "label": "Case Access",
            "pick_list": "sobject_field_values_list",
            "pick_list_params": {
              "sobject_name": "\"AccountTeamMember\""
            },
            "optional": true,
            "custom": false,
            "toggle_hint": "Select from list",
            "toggle_field": {
              "control_type": "text",
              "label": "Case Access",
              "toggle_hint": "Enter custom value",
              "optional": true,
              "custom": false,
              "sfdc_createable": true,
              "sfdc_updateable": true,
              "type": "string",
              "name": "CaseAccessLevel"
            },
            "sfdc_createable": true,
            "sfdc_updateable": true
          },
          {
            "type": "string",
            "name": "ContactAccessLevel",
            "control_type": "select",
            "label": "Contact Access",
            "pick_list": "sobject_field_values_list",
            "pick_list_params": {
              "sobject_name": "\"AccountTeamMember\""
            },
            "optional": true,
            "custom": false,
            "toggle_hint": "Select from list",
            "toggle_field": {
              "control_type": "text",
              "label": "Contact Access",
              "toggle_hint": "Enter custom value",
              "optional": true,
              "custom": false,
              "sfdc_createable": true,
              "sfdc_updateable": true,
              "type": "string",
              "name": "ContactAccessLevel"
            },
            "sfdc_createable": true,
            "sfdc_updateable": true
          },
          {
            "type": "string",
            "name": "CreatedById",
            "control_type": "text",
            "label": "Created By ID",
            "optional": true,
            "custom": false,
            "sfdc_createable": false,
            "sfdc_updateable": false
          },
          {
            "type": "date_time",
            "name": "CreatedDate",
            "control_type": "date_time",
            "label": "Created Date",
            "optional": true,
            "custom": false,
            "render_input": "render_iso8601_timestamp",
            "parse_output": "parse_iso8601_timestamp",
            "sfdc_createable": false,
            "sfdc_updateable": false
          },
          {
            "type": "boolean",
            "name": "IsDeleted",
            "control_type": "checkbox",
            "label": "Deleted",
            "optional": true,
            "custom": false,
            "toggle_hint": "Select from option list",
            "toggle_field": {
              "label": "Deleted",
              "control_type": "text",
              "toggle_hint": "Use custom value",
              "optional": true,
              "custom": false,
              "sfdc_createable": false,
              "sfdc_updateable": false,
              "type": "boolean",
              "name": "IsDeleted"
            },
            "render_input": {
            },
            "parse_output": {
            },
            "sfdc_createable": false,
            "sfdc_updateable": false
          },
          {
            "type": "string",
            "name": "LastModifiedById",
            "control_type": "text",
            "label": "Last Modified By ID",
            "optional": true,
            "custom": false,
            "sfdc_createable": false,
            "sfdc_updateable": false
          },
          {
            "type": "date_time",
            "name": "LastModifiedDate",
            "control_type": "date_time",
            "label": "Last Modified Date",
            "optional": true,
            "custom": false,
            "render_input": "render_iso8601_timestamp",
            "parse_output": "parse_iso8601_timestamp",
            "sfdc_createable": false,
            "sfdc_updateable": false
          },
          {
            "type": "string",
            "name": "OpportunityAccessLevel",
            "control_type": "select",
            "label": "Opportunity Access",
            "pick_list": "sobject_field_values_list",
            "pick_list_params": {
              "sobject_name": "\"AccountTeamMember\""
            },
            "optional": true,
            "custom": false,
            "toggle_hint": "Select from list",
            "toggle_field": {
              "control_type": "text",
              "label": "Opportunity Access",
              "toggle_hint": "Enter custom value",
              "optional": true,
              "custom": false,
              "sfdc_createable": true,
              "sfdc_updateable": true,
              "type": "string",
              "name": "OpportunityAccessLevel"
            },
            "sfdc_createable": true,
            "sfdc_updateable": true
          },
          {
            "type": "date_time",
            "name": "SystemModstamp",
            "control_type": "date_time",
            "label": "System Modstamp",
            "optional": true,
            "custom": false,
            "render_input": "render_iso8601_timestamp",
            "parse_output": "parse_iso8601_timestamp",
            "sfdc_createable": false,
            "sfdc_updateable": false
          },
          {
            "type": "string",
            "name": "TeamMemberRole",
            "control_type": "select",
            "label": "Team Role",
            "sticky": true,
            "pick_list": "sobject_field_values_list",
            "pick_list_params": {
              "sobject_name": "\"AccountTeamMember\""
            },
            "optional": true,
            "custom": false,
            "toggle_hint": "Select from list",
            "toggle_field": {
              "control_type": "text",
              "label": "Team Role",
              "toggle_hint": "Enter custom value",
              "optional": true,
              "custom": false,
              "sfdc_createable": true,
              "sfdc_updateable": true,
              "type": "string",
              "name": "TeamMemberRole"
            },
            "sfdc_createable": true,
            "sfdc_updateable": true
          },
          {
            "type": "string",
            "name": "Title",
            "control_type": "text",
            "label": "Title",
            "optional": true,
            "custom": false,
            "sfdc_createable": false,
            "sfdc_updateable": false
          },
          {
            "type": "string",
            "name": "PhotoUrl",
            "control_type": "url",
            "label": "Url for thumbnail sized photo",
            "optional": true,
            "custom": false,
            "sfdc_createable": false,
            "sfdc_updateable": false
          },
          {
            "type": "string",
            "name": "UserId",
            "control_type": "text",
            "label": "User ID",
            "sticky": true,
            "optional": true,
            "custom": false,
            "sfdc_createable": true,
            "sfdc_updateable": false
          }
        ],
        "visible_config_fields": [
          "sobject_name",
          "field_list",
          "limit",
          "AccountId",
          "TeamMemberRole",
          "table_list"
        ],
        "hidden_config_fields": [
          "UserId"
        ],
        "comment": "If there is any Account Team Member exists with the same role, use the related user's NetSuite employee id to replace with the existing team member in Netsuite",
        "uuid": "56497b67-70de-4ad1-9d43-b3d515ff05f1"
      },
      {
        "number": 2,
        "provider": "workato_service",
        "name": "call_service_async",
        "as": "844de59f",
        "title": null,
        "description": "Call recipe <span class=\"provider\">Update NetSuite Customer Team Member</span> (do not wait for response)",
        "keyword": "action",
        "dynamicPickListSelection": {
          "flow_id": "Update NetSuite Customer Team Member"
        },
        "toggleCfg": {
        },
        "input": {
          "flow_id": {
            "zip_name": "netsuite/callable/callable_update_netsuite_customer_team_member.recipe.json",
            "name": "Callable - Update NetSuite Customer Team Member",
            "folder": "netsuite/callable"
          },
          "request": {
            "team_role": "#{_('data.salesforce.3bcc59df.TeamRole__c')}",
            "ns_customer_internal_id": "#{_('data.salesforce.3bcc59df.NetsuiteCustomerId__c')}",
            "employee_id": "#{_('data.salesforce.572a57ef.AccountTeamMember.first.User.EmployeeID__c')}"
          }
        },
        "extended_input_schema": [
          {
            "type": "object",
            "name": "request",
            "label": "Recipe input",
            "properties": [
              {
                "control_type": "text",
                "label": "Team Role",
                "name": "team_role",
                "type": "string",
                "optional": false,
                "parent": "request"
              },
              {
                "control_type": "text",
                "label": "NetSuite Customer Internal ID",
                "name": "ns_customer_internal_id",
                "type": "string",
                "optional": false,
                "parent": "request"
              },
              {
                "control_type": "text",
                "label": "Employee ID",
                "name": "employee_id",
                "type": "string",
                "optional": true,
                "parent": "request"
              }
            ]
          }
        ],
        "visible_config_fields": [
          "flow_id",
          "request.ns_employee_internal_id",
          "request",
          "request.team_role",
          "request.ns_customer_internal_id",
          "request.ns_employee_id",
          "request.employee_id"
        ],
        "comment": "This step is responsible for deleting/replacing the corresponding NetSuite Team Member",
        "uuid": "9b7f4f1f-a072-47f6-bc4f-fda5aefe51dc"
      }
    ],
    "job_report_schema": [
      {
        "name": "custom_column_1",
        "label": "SFDC Account Id"
      },
      {
        "name": "custom_column_2",
        "label": "NS Customer Id"
      },
      {
        "name": "custom_column_5",
        "label": "Team Role"
      },
      {
        "name": "custom_column_3",
        "label": "Deleted NS Employee Id"
      },
      {
        "name": "custom_column_4",
        "label": "Replacement  NS Employee Id"
      }
    ],
    "job_report_config": {
      "custom_column_1": "#{_('data.salesforce.3bcc59df.AccountId__c')}",
      "custom_column_2": "#{_('data.salesforce.3bcc59df.NetsuiteCustomerId__c')}",
      "custom_column_5": "#{_('data.salesforce.3bcc59df.TeamRole__c')}",
      "custom_column_3": "#{_('data.salesforce.3bcc59df.NetsuiteEmployeeId__c')}",
      "custom_column_4": "#{_('data.salesforce.572a57ef.AccountTeamMember.first.User.NetsuiteEmployeeId__c')}"
    },
    "uuid": "dec0834b-d946-42c8-acb3-83da1f6e2f5b"
  },
  "config": [
    {
      "keyword": "application",
      "provider": "salesforce",
      "skip_validation": false,
      "account_id": {
        "zip_name": "connections/salesforce.connection.json",
        "name": "Salesforce",
        "folder": "connections"
      }
    },
    {
      "keyword": "application",
      "provider": "workato_service",
      "skip_validation": false,
      "account_id": null
    }
  ]
}